<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Article</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
    font-family: Arial, sans-serif;
}
.container {
    width: 80%;
    margin: auto;
    padding: 20px;
}
.heading {
    font-size: 2em;
    font-weight: bold;
    margin-bottom: 20px;
}
.voting-bar-container {
    margin-bottom: 20px;
    
}
.voting-bar {
    width: 100%;
    height: 20px;
    background-color:#c97171;
    border-style: solid;
  border-width: 2px;
    position: relative;
    border-radius: 20px;
    border-color: rgb(50, 43, 43);
   
}
.bar {
    height: 100%;
    width: 50%;
    background-color: rgba(255, 255, 255, 0.5);
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
}
.votes {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
}
.tabs {
    display: flex;
    border-bottom: 1px solid #ccc;
}
.tab {
    padding: 10px 20px;
    cursor: pointer;
    border: 1px solid #ccc;
    border-bottom: none;
    margin-right: 5px;
}
.tab.active {
    background-color: #f1f1f1;
    font-weight: bold;
}
.tab-content {
    border: 1px solid #ccc;
    padding: 20px;
    display: none;
}
.tab-content.active {
    display: block;
}



        #inner-bar1 {
            position: absolute;
            background:rgb(198, 186, 58); /* Gradient for inner bar */
            width: 0%; /* Initial width, adjust as needed */
            height: 100%;
            border-radius: 20px; /* Rounded corners on the left */
            transition: width 0.5s ease; /* Smooth transition for width */
        }
   
/* The sidepanel menu */
.sidepanel {
  height: 100%; /* Specify a height */
  width: 0; /* 0 width - change this with JavaScript */
  position: absolute; /* Stay in place */
  z-index: 20; /* Stay on top */
  top: 0;
  left: 0;
  background-color: #111; /* Black*/
  overflow-x: hidden; /* Disable horizontal scroll */
  padding-top: 60px; /* Place content 60px from the top */
  transition: 0.5s; /* 0.5 second transition effect to slide in the sidepanel */
}

/* The sidepanel links */
.sidepanel a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: #dfdfdf;
  display: block;
  transition: 0.3s;
}

/* When you mouse over the navigation links, change their color */
.sidepanel a:hover {
 /* color: #f1f1f1;*/
}

/* Position and style the close button (top right corner) */
.sidepanel .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

/* Style the button that is used to open the sidepanel */
.openbtn {
  font-size: 20px;
  cursor: pointer;
  background-color: transparent;
  color: rgb(0, 0, 0);
  padding: 10px 15px;
  border: none;
}

.openbtn:hover {
  /*background-color: #444;*/
}
h3{
    margin-top: 20px;
}

    </style>
</head>
<body>
    <div id="mySidepanel" class="sidepanel">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="/">Home</a>
        
      </div>
      
      
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <button class="openbtn" onclick="openNav()">&#9776; </button>
      <!--    <img src="/docs/4.1/assets/brand/bootstrap-solid.svg" width="30" height="30" class="d-inline-block align-top" alt="logo here"> -->
          <b>సమతాప</b>
        </a>
      </nav>
    <div class="container">
        <div class="heading">{{article.title}}</div>
        
        <div class="voting-bar-container">
            <div class="voting-bar">
                <div id="inner-bar1" ></div>
                
            </div>
            <div class="votes">
                {% for view in views %}
               <div> <span>{{view.view_name}}</span><span id="{{ view.view_id  }}"> Votes: 0</span></div>
                {% endfor %}
            </div>
        </div>
        <div class="tabs">
            {% for view in views %}
            {% if forloop.counter == 1 %}
            <div class="tab active" data-tab="{{view.view_id}}">{{view.view_name}}</div>
            {% else %}
            <div class="tab " data-tab="{{view.view_id}}">{{view.view_name}}</div>
            {% endif %}
            {% endfor %}
           
        </div>
        {% for view in views %}

        {% if forloop.counter == 1 %}
        <div class="tab-content active" id="{{view.view_id}}"  >
        {% else %}
        <div class="tab-content" id="{{view.view_id}}"  >
        {% endif %}

        <button type="button" class="btn btn-outline-dark" onclick="vote('{{view.view_id}}' )">నేను దీన్ని మద్దతు ఇస్తున్నాను</button>
            
            <h3 >{{view.view_heading}}</h3>
            <img src="{{ article.headline_image.url }}" alt="News Image" width="200">
            <p>
                {{view.content|safe}}
                <a href="www.example.com">more</a>    
            </p>
           </div>
           {% endfor %}
    </div>

    <script>
        let votes={};
        votes['totalvotes']=0;
        {% for view in views %}
        votes["{{ view.view_id }}"] = 0;
    {% endfor %}
        const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');
fetchResults({{article.article_id}});

tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const target = tab.getAttribute('data-tab');
        tabContents.forEach(content => {
            content.classList.remove('active');
            if (content.id === target) {
                content.classList.add('active');
            }
        });
    });
});

function vote(side) {
    fetch('/vote/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
             // Include CSRF token if CSRF protection is enabled
        },
        body: JSON.stringify({ 'option_id': side })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update the local votes and fetch the updated results
           // votes[side]++;
            //votes['totalvotes']++;
            //updateVotes();
            fetchResults({{article.article_id}})
        } else {
            console.error(data.message);
        }
    })
    .catch(error => console.error('Error:', error));
console.log(side)


//votes['totalvotes']+=1;
  //  updateVotes();
}

function updateVotes() {
   
    {% for view in views %}
    {% if forloop.counter == 1 %}
     one=votes["{{ view.view_id }}"];
     {% endif %}
        document.getElementById("{{ view.view_id }}").textContent = `{{view.view_name}} Votes: ${votes["{{ view.view_id }}"]}`;
        
        
    {% endfor %}
    console.log(votes);
    
    //console.log(one);
    //console.log(votes['totalvotes'])
    const leftPercentage = (one / votes['totalvotes']) * 100;
    //console.log(leftPercentage);
    document.getElementById('inner-bar1').style.width = `${leftPercentage}%`;
}
let one=0;
function fetchResults(pollId) {
    fetch(`/poll/${pollId}/results/`)
    .then(response => response.json())
    .then(data => {
        // Handle the results update (this is just an example)
        console.log(data);
        if (data.total_votes) {
            let i=0;
            Object.keys(data).forEach(key => {
                
                if (key !== 'total_votes') {
                    if(i==0){
                       one=data[key]
                }
                i++;
                    document.getElementById(`${key}`).textContent = ` Votes: ${data[key]}`;
                }
            });
            // Update the bar width based on results
            const leftPercentage = (one / data['total_votes']) * 100; // Example for one option
            document.getElementById('inner-bar1').style.width = `${leftPercentage}%`;
        }
    })
    .catch(error => console.error('Error fetching results:', error));
}

       
       function openNav() {
  document.getElementById("mySidepanel").style.width = "250px";
}

/* Set the width of the sidebar to 0 (hide it) */
function closeNav() {
  document.getElementById("mySidepanel").style.width = "0";
}
    
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>